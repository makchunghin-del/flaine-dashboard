<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Flaine & Grand Massif Snowboard Dashboard</title><style>
:root{
  --bg:#eef2f7; --card:#ffffff; --text:#0b1220; --muted:#5b6575;
  --brand:#0c3b66; --brand2:#0a2f52;
  --ok:#0f7b3a; --warn:#b26a00;
  --ring: rgba(12,59,102,.18);
  --shadow: 0 10px 22px rgba(0,0,0,.08);
}
body.dark{
  --bg:#0b1220; --card:#0f172a; --text:#e8eefc; --muted:#a9b4c7;
  --ring: rgba(148,163,184,.18);
  --shadow: 0 10px 22px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}

.topbar{position:sticky;top:0;z-index:10;background:linear-gradient(90deg,var(--brand),var(--brand2));color:#fff;padding:14px 16px}
.topbar-row{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
.btn{border:none;border-radius:999px;padding:10px 12px;background:rgba(255,255,255,.14);color:#fff;font-weight:800;cursor:pointer}

.wrap{padding:14px;max-width:1200px;margin:auto}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}

.card{background:var(--card);border-radius:16px;box-shadow:var(--shadow);border:1px solid var(--ring)}
.card-h{padding:12px 14px;display:flex;justify-content:space-between;align-items:center}
.card-b{padding:12px 14px}

.badge{border:1px solid var(--ring);border-radius:999px;padding:6px 10px;font-weight:800;font-size:.8rem}
.badge.ok{color:var(--ok)} .badge.warn{color:var(--warn)}

.tiles{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.tile{padding:12px;border-radius:14px;border:1px solid var(--ring);background:rgba(12,59,102,.06)}
body.dark .tile{background:rgba(148,163,184,.07)}
.tile .k{font-size:.8rem;color:var(--muted)}
.tile .v{font-size:1.25rem;font-weight:900}

iframe{width:100%;border:1px solid var(--ring);border-radius:14px;background:#fff}

.pdfwrap{border:1px solid var(--ring);border-radius:14px;overflow:hidden}
.pdfbar{display:flex;justify-content:space-between;gap:8px;padding:10px;background:rgba(12,59,102,.06)}
.pdfbtn{border:1px solid var(--ring);border-radius:999px;padding:6px 10px;font-weight:900;background:transparent;cursor:pointer}
canvas{width:100%;display:block;background:#fff}

.chk{display:flex;gap:10px;padding:10px;border:1px solid var(--ring);border-radius:14px}

.col-12{grid-column:span 12}
@media(max-width:860px){.tiles{grid-template-columns:1fr}}
</style></head><body><div class="topbar">
  <div class="topbar-row">
    <div>
      <strong>Flaine & Grand Massif</strong><br>
      <span style="font-size:.85rem;opacity:.9">Weather ‚Ä¢ Maps ‚Ä¢ Off-piste ‚Ä¢ Lift status</span>
    </div>
    <button class="btn" id="darkBtn">üåô Dark</button>
  </div>
</div><div class="wrap">
<div class="grid"><!-- WEATHER --><div class="card col-12">
  <div class="card-h">
    <strong>Live Weather (Flaine)</strong>
    <span class="badge ok" id="wxStatus">Live</span>
  </div>
  <div class="card-b tiles">
    <div class="tile"><div class="k">Temperature</div><div class="v" id="wxTemp">--</div></div>
    <div class="tile"><div class="k">Wind</div><div class="v" id="wxWind">--</div></div>
    <div class="tile"><div class="k">Wind Gust</div><div class="v" id="wxGust">--</div></div>
    <div class="tile"><div class="k">Snow (next hours)</div><div class="v" id="wxSnow">--</div></div>
  </div>
</div><!-- PISTE MAP (PDF) --><div class="card col-12">
  <div class="card-h"><strong>Piste Map (PDF)</strong></div>
  <div class="card-b">
    <div class="pdfwrap">
      <div class="pdfbar">
        <span class="badge" id="pdfStatus">Loading‚Ä¶</span>
        <div>
          <button class="pdfbtn" id="prev">‚óÄ</button>
          <button class="pdfbtn" id="next">‚ñ∂</button>
          <button class="pdfbtn" id="zoomOut">Ôºç</button>
          <button class="pdfbtn" id="zoomIn">Ôºã</button>
          <button class="pdfbtn" id="fit">Fit</button>
          <a class="badge" href="GM_PlanPistes_25_26_HD_copy.pdf" target="_blank">Open PDF</a>
        </div>
      </div>
      <canvas id="pdfCanvas"></canvas>
    </div>
  </div>
</div><!-- OFF-PISTE --><div class="card col-12">
  <div class="card-h"><strong>Off-piste (community-known zones)</strong></div>
  <div class="card-b" id="offpisteList"></div>
</div><!-- OFFICIAL LIFT STATUS (LAST) --><div class="card col-12">
  <div class="card-h">
    <strong>Official Lift & Piste Status</strong>
    <span class="badge ok">Live</span>
  </div>
  <div class="card-b"><strong>Flaine ‚Äì Opening Status</strong>
<iframe src="https://www.flaine.com/en/weather-opening/" loading="lazy" style="height:520px"></iframe>

<div style="height:14px"></div>

<strong>Grand Massif ‚Äì Lift & Piste Map</strong>
<iframe id="gmFrame"
  src="https://www.grand-massif.com/en/trail-map/"
  loading="lazy"
  style="height:520px"></iframe>

<div id="gmFallback" style="display:none;margin-top:10px">
  <a class="badge" target="_blank" href="https://www.grand-massif.com/en/trail-map/">
    Open Grand Massif official map
  </a>
</div>

  </div>
</div></div>
</div><script type="module">
import * as pdfjsLib from './pdf.mjs';
pdfjsLib.GlobalWorkerOptions.workerSrc = new URL('./pdf.worker.mjs', import.meta.url).toString();

const $ = id => document.getElementById(id);
$('darkBtn').onclick = () => document.body.classList.toggle('dark');

// Weather (Open-Meteo)
const LAT=46.001, LON=6.688;
async function loadWeather(){
  try{
    const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,wind_speed_10m,wind_gusts_10m&hourly=snowfall&timezone=auto`);
    const d=await r.json();
    $('wxTemp').textContent=Math.round(d.current.temperature_2m)+'¬∞C';
    $('wxWind').textContent=d.current.wind_speed_10m.toFixed(1)+' m/s';
    $('wxGust').textContent=d.current.wind_gusts_10m.toFixed(1)+' m/s';
    const snow=d.hourly.snowfall.slice(0,6).reduce((a,b)=>a+b,0);
    $('wxSnow').textContent=snow>0?snow.toFixed(1)+' mm':'None';
  }catch(e){
    $('wxStatus').textContent='Unavailable';
    $('wxStatus').className='badge warn';
  }
}
loadWeather();

// GM iframe fallback
setTimeout(()=>{
  const f=$('gmFrame');
  try{
    if(!f.contentDocument || f.contentDocument.body.innerHTML.length<100){
      f.style.display='none';
      $('gmFallback').style.display='block';
    }
  }catch(e){
    f.style.display='none';
    $('gmFallback').style.display='block';
  }
},3000);

// Off-piste list
const zones=[
  {name:'Combe de Gers',desc:'High alpine bowl. Best with a guide.'},
  {name:'Lindars / V√©ret Bowls',desc:'Accessible side bowls near upper lifts.'},
  {name:'Trees toward Samo√´ns',desc:'Sheltered lines, good in low visibility.'},
  {name:'Trees toward Les Carroz',desc:'Sunny side, watch return timing.'}
];
const root=$('offpisteList');
zones.forEach(z=>{
  const d=document.createElement('div');
  d.className='chk';
  d.innerHTML=`<strong>${z.name}</strong><br><span style="color:var(--muted);font-size:.9rem">${z.desc}</span>`;
  root.appendChild(d);
});

// PDF
const PDF='GM_PlanPistes_25_26_HD_copy.pdf';
let pdf,page=1,scale=0.9,fit=true;
const DPR=Math.min(devicePixelRatio||1,1.5);
const canvas=$('pdfCanvas'),ctx=canvas.getContext('2d');
async function render(){
  const p=await pdf.getPage(page);
  const base=p.getViewport({scale:1});
  if(fit) scale=(canvas.parentElement.clientWidth/base.width)*0.98;
  const vp=p.getViewport({scale});
  canvas.width=vp.width*DPR; canvas.height=vp.height*DPR;
  canvas.style.width=vp.width+'px'; canvas.style.height=vp.height+'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
  await p.render({canvasContext:ctx,viewport:vp}).promise;
  $('pdfStatus').textContent='Ready';
}
async function loadPdf(){ pdf=await pdfjsLib.getDocument(PDF).promise; render(); }
$('prev').onclick=()=>{if(page>1){page--;render();}};
$('next').onclick=()=>{if(page<pdf.numPages){page++;render();}};
$('zoomIn').onclick=()=>{fit=false;scale+=0.15;render();};
$('zoomOut').onclick=()=>{fit=false;scale=Math.max(0.6,scale-0.15);render();};
$('fit').onclick=()=>{fit=true;render();};
setTimeout(loadPdf,300);
</script></body>
</html>